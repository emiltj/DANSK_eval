---
title: "plots_thesis"
output: html_document
date: "2023-03-14"
---

# LOAD PACKAGES
```{r}
library("pacman")
library("ggplot2")
library("tidyverse")
library("RColorBrewer")

#pacman::p_load(ggplot2, tidyverse, corrr, RColorBrewer)
```

# CONFUSION MATRICES
DANSK vs interrater
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/conf_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "lightblue",
                       high = "red",
                       mid = "white",
                       midpoint = 150,
                       limit = c(0,300),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(title = "DANSK and initial annotations",
       subtitle = "Confusion matrix with DANSK gold annotations and initial annotations",
       x = "Initial annotations accumulated", 
       y = "DANSK gold") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.subtitle = element_text(hjust = 0.5))

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK_initial/conf_mtx_initial_vs_DANSK.png")
```
Small
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/small_confusion_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "lightblue",
                       high = "red",
                       mid = "white",
                       midpoint = 25,
                       limit = c(0,50),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(title = "Prediction errors - small model",
       subtitle = "Confusion matrix of da_dacy_small_ner_fine_grained",
       x = "da_dacy_small_ner_fine_grained", 
       y = "DANSK gold") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.subtitle = element_text(hjust = 0.5))


# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/conf_sm.png")
```
Medium
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/medium_confusion_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "lightblue",
                       high = "red",
                       mid = "white",
                       midpoint = 25,
                       limit = c(0,50),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(title = "Prediction errors - medium model",
       subtitle = "Confusion matrix of da_dacy_medium_ner_fine_grained",
       x = "da_dacy_medium_ner_fine_grained", 
       y = "DANSK gold annotations") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.subtitle = element_text(hjust = 0.5))


# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/conf_md.png")
```
Large
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/large_confusion_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "lightblue",
                       high = "red",
                       mid = "white",
                       midpoint = 25,
                       limit = c(0,50),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  # Labs
  labs(title = "Prediction errors - large model",
       subtitle = "Confusion matrix of da_dacy_large_ner_fine_grained",
       x = "da_dacy_large_ner_fine_grained", 
       y = "DANSK gold annotations")# +
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.subtitle = element_text(hjust = 0.5))

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/conf_lg.png")
```

# NER MODEL PERFORMANCE
F1, RECALL, PRECISION PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/f1_recall_precision.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained"))
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(y=value, x=rowname)) +
  # Geom_bar
  geom_point(size = 3.5,
          aes(color=colname),
          stat="identity") +

  geom_point(shape=1, size=3.5, colour="black")+

  scale_color_brewer(palette = "Set2") +

  coord_flip() + 
  
  # theme_minimal() +

  # Set labs
  labs(title = "Performance",
       subtitle = "F1, recall and precision scores of the NER fine-grained models",
       x = "Model",
       y = "Score",
       color = 'Metric')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/f1_recall_precision.png")
```

DOMAIN PERFORMANCE
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/domain_f1_wide.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select(!(name="across_domains"))

df

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained"))
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(y=value, x=rowname)) +
  # Geom_bar
  geom_point(size = 3.5,
          aes(color=colname),
          stat="identity") +

  geom_point(shape=1, size=3.5, colour="black")+

  scale_color_brewer(palette = "Set2") +

  coord_flip() + 
  
  # theme_minimal() +

  # Set labs
  labs(title = "F1-scores across domains",
       subtitle = "F1-performance of the NER fine-grained models",
       x = "Model",
       y = "F1-score",
       color = 'Domain')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/thesis/NER/domain.png")
```
TAG PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/tag_f1_wide.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

df <- df %>% select(!(name="Domain"))

colnames(df)[length(colnames(df))] <- "WORK OF ART"

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained"))
df_wide$colname <- factor(df_wide$colname)
df_wide$colname <- fct_rev(df_wide$colname)

# Plot
ggplot(df_wide, aes(y=value, x=colname)) +
  # Geom_bar
  geom_point(size = 3.5,
          aes(color=colname),
          stat="identity",
          show.legend = FALSE) +

  geom_point(shape=1, size=3.5, colour="black")+

  #scale_color_brewer() +#palette = "") +

  coord_flip() + 
  
  guides(color = guide_legend(reverse=TRUE)) +

  #theme_minimal() +

  # Set labs
  labs(title = "F1-scores across tags",
       subtitle = "F1-performance of the NER fine-grained models",
       x = "Model",
       y = "F1-score",
       color = 'Tag') +
  
  facet_wrap(~rowname, ncol=3)

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/tag.png")
```

# OTHER MODELS PERFORMANCE
F1, RECALL, PRECISION PERFORMANCE
```{r}
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/f1_recall_precision.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf",                   "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md", "da_core_news_sm"))
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(y=value, x=rowname)) +
  # Geom_bar
  geom_point(size = 3.5,
          aes(color=colname),
          stat="identity") +

  geom_point(shape=1, size=3.5, colour="black")+

  scale_color_brewer(palette = "Set2") +

  coord_flip() + 
  
  # theme_minimal() +

  # Set labs
  labs(title = "Performance",
       subtitle = "F1, recall and precision scores of Danish SOTA models",
       x = "Model",
       y = "Score",
       color = 'Metric')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/f1_recall_precision.png")
```

GENERAL PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select((name="across_domains"))

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# Reverse order
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(color=rowname, y=value, x=rowname)) +
  # Geom_bar
  geom_point(#position = position_dodge(width = 0.7),
           #width=0.7,
          size = 2.5,
          aes(color=rowname),
          stat="identity",
          show.legend = FALSE) + #,
           #colour="black") +
  
  # Add text with F1-scores
  geom_text(aes(label=round(value, 2)), vjust=-.8, color="black", size=3.5) +
  
  guides(color = guide_legend(reverse=TRUE)) +
  
  geom_point(shape=1, size=2.5, colour="black")+

  #scale_color_brewer(palette = "Set2") +

  coord_flip() + 

  # Set labs
  labs(title = "F1-scores on DANSK",
       subtitle = "F1-performance of Danish SOTA models",
       x = "Model",
       y = "F1-score",
       color = 'Model')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/general.png")
```
DOMAIN MODEL PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select(!(name="across_domains"))

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# Reverse order
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(color=colname, y=value, x=rowname)) +
  # Geom_bar
  geom_point(#position = position_dodge(width = 0.7),
           #width=0.7,
          size = 2.5,
          aes(color=colname),
          stat="identity") + #,
           #colour="black") +
    
  geom_point(shape=1, size=2.5, colour="black") +

  scale_color_brewer(palette = "Set2") +

  coord_flip() + 

  # Set labs
  labs(title = "F1-scores across domains",
       subtitle = "F1-performance of Danish SOTA models",
       x = "Model",
       y = "F1-score",
       color= 'Domain')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/domain.png")
```
TAG MODEL PERFORMANCE
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/tag_f1_wide.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Factor by right order
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# Reverse order
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot 
ggplot(df_wide, aes(color=colname, y=value, x=rowname)) + 
  # Geom_bar
  geom_point(#position = position_dodge(width = .8),
           #width=.8,
          size=2.5,
           stat="identity") +#,
           # colour="black") +
  
  geom_point(shape=1, size=2.5, colour="black")+
  
  scale_color_brewer(palette = "Set2") +  
  
  coord_flip() +
  
  #theme_minimal() +
  
  # Set labs
  labs(title = "F1-scores across tags",
       subtitle = "F1-performance of Danish SOTA models",
       x = "Model", 
       y = "F1-score",
       color = 'Tag')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/tag.png")
```


# CSV's for TABLES (see docs for how to structure):
Kappa
```{r}
# Avg kappa per annotator initially. On token level and on annotated token level
non_annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_also_non_annotated.csv")
annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_annotated.csv")

non_annotated = non_annotated %>% select("Avg. Cohen's Kappa annotated tokens"="rater_avg")
annotated = annotated %>% select("Avg. Cohen's Kappa tokens"="rater_avg")

kappa = cbind(non_annotated, annotated)

rownames <- c("Annotator 1", "Annotator 2", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "Annotator 10")

rownames(kappa) <- rownames

write.csv(kappa, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK_initial/kappa.csv")
```

Doc overlap
```{r}
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/doc_overlap.csv")

df = df %>% select(!"X")

rownames <- c("Annotator 1", "Annotator 2", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "Annotator 10")

colnames <- c("Annotator 1", "Annotator 2", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "Annotator 10")

rownames(df) <- rownames
colnames(df) <- colnames

write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK_initial/doc_overlap.csv")
```

Tag counts
```{r}
# Already there from the "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/src/inter_annotators_matrix.ipynb"
```

DANSK
- Overall
- Full, train, dev, test (including domain + tag distribution)
```{r}
# Overall has be made manually; located in "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/overall.tgn")

# Full
full = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/full/domain_desc_stats_wide.csv")
full = full[,order(colnames(full))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(full) = new_col_names
full <- full[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
write.csv(full, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/full.csv")

# Train
train = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/train/domain_desc_stats_wide.csv")
train = train[,order(colnames(train))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(train) = new_col_names
train <- train[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
write.csv(train, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/train.csv")

# Dev
dev = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/dev/domain_desc_stats_wide.csv")
dev = dev[,order(colnames(dev))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(dev) = new_col_names
dev <- dev[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
write.csv(dev, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/dev.csv")

# Test
test = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/test/domain_desc_stats_wide.csv")
test = test[,order(colnames(dev))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(test) = new_col_names
test <- test[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
write.csv(test, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/test.csv")

```

SOTA
- Recall, Precision, F1-score
- Domain
- Tag
```{r}
# Recall, precision and F1-score
# Already present in "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/f1_recall_precision.csv")

# Domain (including across domains)
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books")
colnames(df) = new_col_names
df <- df[c(1, 2, 3, 10, 4, 5, 6, 7, 8, 9),]
df = round(df, 3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/domain.csv")

# Tag
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/tag_f1_wide.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
df = round(df, 3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/tag.csv")

```

NER
- Type performance
- Recall, Precision, F1-score
- Domain
- Tag
```{r} 
# Type performance
df = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/types_matches_f1.csv")
df["Model"] = c("da_dacy_small_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_large_ner_fine_grained")
df = df %>% select(!"X")
colnames(df) = c("Model", "F1 Strict Match", "F1 Exact Match", "F1 Partial Match", "Entity Type Match")
df = df %>% mutate_if(is.numeric, round, digits=3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/type.csv")

# Recall, Precision and F1-score
# Already present in "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/f1_recall_precision.csv")

# Domain
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/domain_f1_wide.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books")
colnames(df) = new_col_names
df = round(df, 3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/domain.csv")

# Tag
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/tag_f1_wide.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
df = df  %>% select(!Domain)
df = round(df, 3)
colnames(df)[18] = "WORK OF ART"
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/tag.csv")

```










# OLD, MIGHT NOT USE:
output/DANSK_initial_interrater/kappa_also_non_annotated.csv 
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_also_non_annotated.csv", header=T)

# Clean up dataset
df <- df %>% select(!(name=c("X","rater_avg"))) # Remove first and last columns
colnames(df) <- c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")#, "rater_avg") # Change colnames

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Have annotators as factors
df_wide$rowname <- as.factor(df_wide$rowname) 
df_wide$colname <- as.factor(df_wide$colname) 

# Remove rows with kappa score between same annotators
df_wide = df_wide %>% filter(colname != rowname)

# Create plot
ggplot(df_wide, aes(x = reorder(rowname, sort(as.numeric(rowname), decreasing=T)), y = value, fill=reorder(rowname, sort(as.numeric(rowname),decreasing=T)))) +
  # Violin plot, don't trim 
  geom_violin(trim=FALSE) +
  
  # Include boxplot also
  geom_boxplot(width=.1,
               fill="white") + 
  
  # Set theme
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        legend.position="right") +
  
  # Set labs
  labs(title = "Cohen's Kappa all tokens",
       subtitle = "Cohens Kappa scores between annotators, when including all tokens",
       x = "Annotator", 
       y = "Cohen's Kappa",
       fill='Annotator')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_also_non_annotated_plot.png")
```
output/DANSK_initial_interrater/kappa_annotated.csv
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_annotated.csv", header=T)

# Clean up dataset
df <- df %>% select(!(name=c("X","rater_avg"))) # Remove first and last columns
colnames(df) <- c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")#, "rater_avg") # Change colnames

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Have annotators as factors
df_wide$rowname <- as.factor(df_wide$rowname) 
df_wide$colname <- as.factor(df_wide$colname) 

# Remove rows with kappa score between same annotators
df_wide = df_wide %>% filter(colname != rowname)

# Create plot
ggplot(df_wide, aes(x = reorder(rowname, sort(as.numeric(rowname), decreasing=T)), y = value, fill=reorder(rowname, sort(as.numeric(rowname),decreasing=T)))) +  
  
  # Violin plot, don't trim 
  geom_violin(trim=FALSE) +
  
  # Include boxplot also
  geom_boxplot(width=.1,
               fill="white") + 
  
  # Set theme
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        legend.position="right") +
  
  # Set labs
  labs(title = "Cohen's Kappa all tokens",
       subtitle = "Cohens Kappa scores between annotators, only including annotated tokens",
       x = "Annotator", 
       y = "Cohen's Kappa",
       fill='Annotator')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_annotated_plot.png")
```
output/DANSK_initial_interrater/tag_counts.csv SKIP BELOW ON TAG_COUNTS; DATA SHOWS NUMBER OF TOKENS WITH TAGS, INSTEAD OF NUMBER OF TAGS IN DOCUMENTS
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/tag_counts.csv", header=T)

# Clean up dataset
colnames(df) <- c("Tag ","1", "2", "3", "4", "5", "6", "7", "8", "9", "10")#, "rater_avg") # Change colnames

# Set Tag column as row names
rownames(df) <- df$Tag

# Remove Tag column from columns
df <- df %>% select(c(2:length(colnames(df))))

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Have annotators as factors
df_wide$rowname <- as.factor(df_wide$rowname)
df_wide$colname <- as.factor(df_wide$colname)

# Create plot
ggplot(df_wide, aes(x = rowname, y = value, fill=rowname)) + 
  
  # Make boxplot
  geom_boxplot() + 
  
  # Set theme
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        legend.position="right") +
  
  # Set labs
  labs(title = "Cohen's Kappa all tokens",
       subtitle = "Cohens Kappa scores between annotators, only including annotated tokens",
       x = "Annotator", 
       y = "Cohen's Kappa",
       fill='Annotator')

```
something
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select(!(name="across_domains"))

df

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# As factors
df_wide$rowname <- as.factor(df_wide$rowname) 
df_wide$colname <- as.factor(df_wide$colname) 

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# # Plot 
# ggplot(df_wide, aes(y=value, x=rowname, fill=rowname)) + 
#   # Geom_bar
#   geom_bar(position = position_dodge(width = 0.7),
#            width=0.7,
#            stat="identity",
#            #fill="white",
#            colour="black") +
#   
#   scale_fill_brewer(palette = "Set2") +  
#   
#     # Add text with F1-scores
#   geom_text(aes(label=round(value, 2)), vjust=1.6, color="white", size=3.5, position = position_dodge(0.7)) +
#   
#   # Set theme
#   theme(plot.title = element_text(hjust = 0.5), 
#         plot.subtitle = element_text(hjust = 0.5),
#         legend.position="right") +
#   
#   # Set labs
#   labs(title = "F1-scores across domains",
#        subtitle = "F1-performance of Danish SOTA models",
#        x = "Model", 
#        y = "F1-score",
#        fill = 'Model') +
#   
#   theme(axis.text.x=element_blank()) +  
#   #theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
#   
#   # Facet_wrap
#   facet_wrap(~colname, ncol=3)

# Plot 
ggplot(df_wide, aes(y=value, x=colname, color=colname)) + 
  # Geom_bar
  geom_point(#position = position_dodge(width = 1),
           #width=1,
           stat="identity") + #,
           #fill="white",
           #colour="black") +
  
  coord_flip() + 
  
  scale_color_brewer(palette = "Set2") +  
  
  # Add text with F1-scores
  #geom_text(aes(label=round(value, 2)), hjust=1.6, color="black", size=4, position = position_dodge(1)) +
  
  # Set theme
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.subtitle = element_text(hjust = 0.5),
  #       legend.position="right") +
  # 
  # Set labs
  labs(title = "F1-scores across domains",
       subtitle = "F1-performance of Danish SOTA models",
       x = "",#"Domain", 
       y = "F1-score",
       fill= 'Domain') +
  
  theme(axis.text.x=element_blank())# +
  #theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Facet_wrap
  #facet_wrap(~rowname, ncol=2)

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long_plot.png")
```
output/other_models_performance/domain_f1_long.csv
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)

# Keep only the across domains
df <- df %>% select(c("rowname"="Model", "value"="across_domains"))

# Factor by right order
df$rowname <- fct_rev(factor(df$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm")))

palette_blues <- colorRampPalette(colors = c("white", "#004b88"))(20)
palette_blues

# Plot
ggplot(df, aes(fill=rowname, y=value, x=rowname)) + 
  # Geom_bar
  geom_bar(position = position_dodge(width = .8),
           width=.7,
           stat="identity",
           colour="black") +
  
  # Add text with F1-scores
  geom_text(aes(label=round(value, 2)), hjust=1.6, color="black", size=4.5, position = position_dodge(0.8)) +
  
  scale_fill_brewer(palette = "palette_blues") +  

  # Set theme
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        legend.position="none") +
  
  coord_flip() +
  
  # Let x-axis dodge to avoid clutter
  #scale_x_discrete(guide = guide_axis(n.dodge=2)) +
  
  # Set labs
  labs(title = "F1-scores",
       subtitle = "F1-performance of Danish SOTA models",
       x = "Model", 
       y = "F1-score")

```



