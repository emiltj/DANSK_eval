---
title: "plots_thesis"
output: html_document
date: "2023-03-14"
---

# LOAD PACKAGES
```{r}
library("kableExtra")
library("pacman")
library("ggplot2")
library("tidyverse")
library("RColorBrewer")

#pacman::p_load(ggplot2, tidyverse, corrr, RColorBrewer)
```

# CONFUSION MATRICES
DANSK vs interrater_initial
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/conf_matrix_initial.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "white",
                       high = "red",
                       #mid = "white",
                       midpoint = 10,
                       limit = c(0,250),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(# title = "DANSK and initial annotations",
       # subtitle = "Confusion matrix with DANSK gold annotations and initial annotations",
       x = "Initial annotations accumulated", 
       y = "DANSK gold") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.# subtitle = element_text(hjust = 0.5))

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK_initial/conf_mtx_initial_vs_DANSK.png")
```
DANSK vs interrater_streamlined
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/conf_matrix_streamlined.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "white",
                       high = "red",
                       #mid = "white",
                       midpoint = 10,
                       limit = c(0,250),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(# title = "DANSK and initial annotations",
       # subtitle = "Confusion matrix with DANSK gold annotations and initial annotations",
       x = "Initial annotations accumulated", 
       y = "DANSK gold") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.# subtitle = element_text(hjust = 0.5))

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/conf_mtx_streamlined_vs_DANSK.png")
```
Small
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/small_confusion_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "white",
                       high = "red",
                       #mid = "white",
                       midpoint = 5,
                       limit = c(0,50),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(# title = "Prediction errors - small model",
       # subtitle = "Confusion matrix of da_dacy_small_ner_fine_grained",
       x = "da_dacy_small_ner_fine_grained", 
       y = "DANSK gold") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.# subtitle = element_text(hjust = 0.5))


# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/conf_sm.png")
```
Medium
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/medium_confusion_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "white",
                       high = "red",
                       #mid = "white",
                       midpoint = 5,
                       limit = c(0,50),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  labs(# title = "Prediction errors - medium model",
       # subtitle = "Confusion matrix of da_dacy_medium_ner_fine_grained",
       x = "da_dacy_medium_ner_fine_grained", 
       y = "DANSK gold annotations") #+
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.# subtitle = element_text(hjust = 0.5))


# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/conf_md.png")
```
Large
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/large_confusion_matrix.csv", header=T)

# Change column names
colnames(df)[1] <- "TAG"
colnames(df)[12] <- "NO TAG"
colnames(df)[20] <- "WORK OF ART"

# Column to index/rownames
df <- df %>% column_to_rownames(., var = 'TAG')

rownames(df)[11] <- "NO TAG"

# Make into wide format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Define levels
levels = ordered(colnames(df))

# Plot df_wide
ggplot(df_wide, aes(x = rowname, y = ordered(colname, levels=rev(levels)))) +
  
  # Fill colour with value
  geom_tile(aes(fill = value)) +
  
  # Colours of fill gradient. OOB = how to handle out of bounds.
  scale_fill_gradient2(low = "white",
                       high = "red",
                       #mid = "white",
                       midpoint = 5,
                       limit = c(0,50),
                       space = "Lab",
                       name="Number of annotations",
                       oob=scales::squish) +
  
  # Text on tiles with value number
  geom_text(aes(label = value), size = 3.5) + 
  
  # All cells equal size
  coord_fixed() +
  
  # Minimal theme to avoid weird borders
  theme_minimal() +
  
  # Labels on x-axis should be tilted (they overlap)
  theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
  
  # Labs
  # Labs
  labs(# title = "Prediction errors - large model",
       # subtitle = "Confusion matrix of da_dacy_large_ner_fine_grained",
       x = "da_dacy_large_ner_fine_grained", 
       y = "DANSK gold annotations")# +
  
  # Theme and positioning
  # theme(plot.title = element_text(hjust = 0.5), 
  #       plot.# subtitle = element_text(hjust = 0.5))

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/conf_lg.png")
```

# NER MODEL PERFORMANCE
F1, RECALL, PRECISION PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/f1_recall_precision.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained"))
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(y=value, x=rowname)) +
  # Geom_bar
  geom_point(size = 5,
          aes(color=colname),
          # color="darkgrey",
          stat="identity") +

  geom_point(shape=1, size = 5, colour="black") +

  scale_color_brewer(palette = "Set2") +
  
  # Add text with F1-scores
  # geom_text(aes(label=ifelse(colname=="F1", round(value, 2), "")), vjust=-1.4, color="black", position = position_dodge(0.7)) +

  coord_flip() + 
  
  theme_linedraw() +

  # Set labs
  labs(# title = "Performance",
       # subtitle = "F1, recall and precision scores of the NER fine-grained models",
       x = "Model",
       y = "Score",
       color = 'Metric')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/f1_recall_precision.png", width = 3000, height = 1500, units = "px")
```
DOMAIN PERFORMANCE
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/domain_f1_wide.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select(!(name="across_domains"))

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Load data with size of domains
size_of_domains = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/test_domain.csv") %>% filter(. ,X == "DOCS") %>% select(. ,c(conversation = Conversation, dannet = Dannet, legal = Legal, news = News, social_media = Social.Media, web = Web, wiki_and_books = Wiki.and.Books))

size_of_domains

# Add size of domains as column in df_wide
df_wide = df_wide %>%
  mutate(score = case_when(
    colname == "conversation" ~ size_of_domains[1,"conversation"],
    colname == "dannet" ~ size_of_domains[1,"dannet"],
    colname == "legal" ~ size_of_domains[1,"legal"],
    colname == "news" ~ size_of_domains[1,"news"],
    colname == "social_media" ~ size_of_domains[1,"social_media"],
    colname == "web" ~ size_of_domains[1,"web"],
    colname == "wiki_and_books" ~ size_of_domains[1,"wiki_and_books"]
    ))
df_wide
df_wide$n_docs = as.integer(df_wide$score)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained"))
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(y=value, x=rowname)) +
  # Geom_bar
  geom_point(#size = 5,
          aes(color = colname,
              size = n_docs),
          stat="identity") +
  
  guides(color = guide_legend(override.aes = list(size = 5))) +

  geom_point(shape=1, aes(size = n_docs), colour="black") +
  
  scale_size(range = c(4, 8)) +

  scale_color_brewer(palette = "Set2") +

  coord_flip() + 
  
  theme_linedraw() +
  
  # Set labs
  labs(# title = "F1-scores across domains",
       # subtitle = "F1-performance of the NER fine-grained models",
       x = "Model",
       y = "F1-score",
       color = 'Domain',
       size = "Number of documents")

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/thesis/NER/domain.png", width = 3000, height = 1500, units = "px")
```
TAG PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/tag_f1_wide.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')
df <- df %>% select(!(name="Domain"))
colnames(df)[length(colnames(df))] <- "WORK OF ART"

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained"))
df_wide$colname <- factor(df_wide$colname)
df_wide$colname <- fct_rev(df_wide$colname)

# Add column with information on number of tags
size_of_tags = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/test_domain.csv") %>% select(., c(ent = X, across_domains = All.domains.combined)) %>% filter(!ent %in% c('ENTS', 'DOCS'))

# Add size of domains as column in df_wide
df_wide = df_wide %>%
  mutate(n_docs = case_when(
    colname == "CARDINAL" ~ size_of_tags[size_of_tags$ent == "CARDINAL", "across_domains"],
    colname == "DATE" ~ size_of_tags[size_of_tags$ent == "DATE", "across_domains"],
    colname == "EVENT" ~ size_of_tags[size_of_tags$ent == "EVENT", "across_domains"],
    colname == "FACILITY" ~ size_of_tags[size_of_tags$ent == "FACILITY", "across_domains"],
    colname == "GPE" ~ size_of_tags[size_of_tags$ent == "GPE", "across_domains"],
    colname == "LANGUAGE" ~ size_of_tags[size_of_tags$ent == "LANGUAGE", "across_domains"],
    colname == "LAW" ~ size_of_tags[size_of_tags$ent == "LAW", "across_domains"],
    colname == "MONEY" ~ size_of_tags[size_of_tags$ent == "MONEY", "across_domains"],
    colname == "NORP" ~ size_of_tags[size_of_tags$ent == "NORP", "across_domains"],
    colname == "ORDINAL" ~ size_of_tags[size_of_tags$ent == "ORDINAL", "across_domains"],
    colname == "ORGANIZATION" ~ size_of_tags[size_of_tags$ent == "ORGANIZATION", "across_domains"],
    colname == "PERCENT" ~ size_of_tags[size_of_tags$ent == "PERCENT", "across_domains"],
    colname == "PERSON" ~ size_of_tags[size_of_tags$ent == "PERSON", "across_domains"],
    colname == "PRODUCT" ~ size_of_tags[size_of_tags$ent == "PRODUCT", "across_domains"],
    colname == "QUANTITY" ~ size_of_tags[size_of_tags$ent == "QUANTITY", "across_domains"],
    colname == "TIME" ~ size_of_tags[size_of_tags$ent == "TIME", "across_domains"],
    colname == "WORK OF ART" ~ size_of_tags[size_of_tags$ent == "WORK OF ART", "across_domains"],
    ))
df_wide$n_docs = as.integer(df_wide$n_docs)

# Plot
ggplot(df_wide, aes(y=value, x=colname)) +
  # Geom_bar
  geom_point(#size = 5,
          aes(size=n_docs),
          color="darkgrey",
          stat="identity",
          show.legend = FALSE) +

  geom_point(shape=1, aes(size=n_docs), colour="black") +
  
  scale_size(range = c(4, 8)) +

  coord_flip() +

  guides(color = guide_legend(reverse=TRUE)) +

  theme_bw() +

  # Set labs
  labs(# title = "F1-scores across tags",
       # subtitle = "F1-performance of the NER fine-grained models",
       x = "Model",
       y = "F1-score",
       size = 'Number of tags') +

  facet_wrap(~rowname, ncol=3)
# 
# ggplot(df_wide, aes(y=value, x=colname, color=rowname)) +
#   # Geom_bar
#   geom_point(size = 4.5,
#           aes(color=rowname),
#           stat="identity",
#           show.legend = TRUE) +
# 
#   geom_point(shape=1, size=4.5, colour="black")+
# 
#   #scale_color_brewer() +#palette = "") +
# 
#   coord_flip() + 
#   
#   guides(color = guide_legend(reverse=TRUE)) +
# 
#   #theme_minimal() +
# 
#   # Set labs
#   labs(title = "F1-scores across tags",
#        # subtitle = "F1-performance of the NER fine-grained models",
#        x = "Model",
#        y = "F1-score",
#        color = 'Model')
#   
# facet_wrap(~rowname, ncol=3)

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/tag.png", width = 3000, height = 1500, units = "px")
```

# OTHER MODELS PERFORMANCE
F1, RECALL, PRECISION PERFORMANCE
```{r}
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/f1_recall_precision.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md", "da_core_news_sm"))
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(y=value, x=rowname)) +
  # Geom_bar
  geom_point(size = 5,
          aes(color=colname),
          stat="identity") +

  geom_point(shape=1, size=5, colour="black")+

  scale_color_brewer(palette = "Set2") +
  
  # geom_text(aes(label=ifelse(colname=="F1", round(value, 2), "")), vjust=-1.4, color="black", position = position_dodge(0.7)) +

  coord_flip() + 
  
  theme_linedraw() +

  # Set labs
  labs(# title = "Performance",
       # subtitle = "F1, recall and precision scores of Danish SOTA models",
       x = "Model",
       y = "Score",
       color = 'Metric')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/f1_recall_precision.png", width = 3000, height = 1500, units = "px")
```
GENERAL PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select((name="across_domains"))

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# Reverse order
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(color=rowname, y=value, x=rowname)) +
  # Geom_bar
  geom_point(#position = position_dodge(width = 0.7),
           #width=0.7,
          size = 5,
          aes(color=rowname),
          stat="identity",
          show.legend = FALSE) + #,
           #colour="black") +
  
  # Add text with F1-scores
  geom_text(aes(label=round(value, 2)), vjust=-1, color="black", size=3.5) +
  
  guides(color = guide_legend(reverse=TRUE)) +
  
  geom_point(shape=1, size=5, colour="black")+

  #scale_color_brewer(palette = "Set2") +
  
  theme_linedraw() +

  coord_flip() + 

  # Set labs
  labs(# title = "F1-scores on DANSK",
       # subtitle = "F1-performance of Danish SOTA models",
       x = "Model",
       y = "F1-score",
       color = 'Model')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/general.png", width = 3000, height = 1500, units = "px")
```
DOMAIN MODEL PERFORMANCE
```{r}
# Load data
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Remove the across domains
df <- df %>% select(!(name="across_domains"))

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Load data with size of domains
size_of_domains = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/test_domain.csv") %>% filter(. ,X == "DOCS") %>% select(. ,c(conversation = Conversation, dannet = Dannet, legal = Legal, news = News, social_media = Social.Media, web = Web, wiki_and_books = Wiki.and.Books))

# Add size of domains as column in df_wide
df_wide = df_wide %>%
  mutate(score = case_when(
    colname == "conversation" ~ size_of_domains[1,"conversation"],
    colname == "dannet" ~ size_of_domains[1,"dannet"],
    colname == "legal" ~ size_of_domains[1,"legal"],
    colname == "news" ~ size_of_domains[1,"news"],
    colname == "social_media" ~ size_of_domains[1,"social_media"],
    colname == "web" ~ size_of_domains[1,"web"],
    colname == "wiki_and_books" ~ size_of_domains[1,"wiki_and_books"]
    ))
df_wide$n_docs = as.integer(df_wide$score)

# Order by custom ordering:
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# Reverse order
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot
ggplot(df_wide, aes(color=colname, y=value, x=rowname)) +
  # Geom_bar
  geom_point(#position = position_dodge(width = 0.7),
           #width=0.7,
          # size = 5,
          aes(color=colname, size = n_docs),
          stat="identity") + #,
           #colour="black") +
    
  geom_point(shape=1, aes(size=n_docs), colour="black") +
  
  guides(color = guide_legend(override.aes = list(size = 5))) +

  scale_color_brewer(palette = "Set2") +

  coord_flip() + 
  theme_linedraw() +
  # Set labs
  labs(# title = "F1-scores across domains",
       # subtitle = "F1-performance of Danish SOTA models",
       x = "Model",
       y = "F1-score",
       color= 'Domain',
       size = "Number of docs")

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/domain.png", width = 3000, height = 1500, units = "px")
```
TAG MODEL PERFORMANCE
```{r}
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/tag_f1_wide.csv", header=T)

# Set model values as rownames
df <- df %>% column_to_rownames(., var = 'Model')

# Make into long format
df_wide <- df %>%
  rownames_to_column() %>%
  gather(colname, value, -rowname)

# Factor by right order
df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))

# Reverse order
df_wide$rowname <- fct_rev(df_wide$rowname)

# Plot 
ggplot(df_wide, aes(color=colname, y=value, x=rowname)) + 
  # Geom_bar
  geom_point(#position = position_dodge(width = .8),
           #width=.8,
          size=5,
           stat="identity") +#,
           # colour="black") +
  
  geom_point(shape=1, size=5, colour="black")+
  
  scale_color_brewer(palette = "Set2") +  
  
  coord_flip() +
  
  theme_linedraw() +
  
  # Set labs
  labs(# title = "F1-scores across tags",
       # subtitle = "F1-performance of Danish SOTA models",
       x = "Model", 
       y = "F1-score",
       color = 'Tag')

# Save plot
ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/tag.png", width = 3000, height = 1500, units = "px")
```

# CSV's for TABLES (see docs for how to structure):
Kappa initial
```{r}
# Avg kappa per annotator initially. On token level and on annotated token level
non_annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_also_non_annotated.csv")
annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_annotated.csv")

non_annotated = non_annotated %>% select("Avg. Cohen's Kappa also non-annotated tokens"="rater_avg")
annotated = annotated %>% select("Avg. Cohen's Kappa only annotated tokens"="rater_avg")

kappa = cbind(non_annotated, annotated)

rownames <- c("Annotator 1", "Annotator 2", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "Annotator 10")

rownames(kappa) <- rownames

write.csv(kappa, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK_initial/kappa.csv")
```
Kappa in the end (Interrater reliability with streamlined and DANSK)
```{r}
# Avg kappa per annotator initially. On token level and on annotated token level
non_annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/kappa_also_non_annotated.csv")
annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/kappa_annotated.csv")

non_annotated = non_annotated %>% select("Avg. Cohen's Kappa also non-annotated tokens"="rater_avg")
annotated = annotated %>% select("Avg. Cohen's Kappa only annotated tokens"="rater_avg")

kappa = cbind(non_annotated, annotated)

rownames <- c("Annotator 1", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "DANSK")

rownames(kappa) <- rownames
kappa
write.csv(kappa, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/kappa.csv")
```

Kappa DANSK
```{r}
# Avg kappa per annotator at the end On token level and on annotated token level
non_annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/kappa_also_non_annotated.csv")[-1]
annotated <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_final_interrater/kappa_annotated.csv")[-1]
cols = c("Annotator 1", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "gold", "rater_avg")
colnames(non_annotated) <- cols
rownames(non_annotated) <- cols[-10]
colnames(annotated) <- cols
rownames(annotated) <- cols[-10]

non_annotated = non_annotated %>% select("Avg. Cohen's Kappa annotated tokens"="rater_avg")
annotated = annotated %>% select("Avg. Cohen's Kappa tokens"="rater_avg")

kappa = cbind(non_annotated, annotated)

write.csv(kappa, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/kappa.csv")
```
Doc overlap
```{r}
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/doc_overlap.csv")

df = df %>% select(!"X")

rownames <- c("Annotator 1", "Annotator 2", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "Annotator 10")

colnames <- c("Annotator 1", "Annotator 2", "Annotator 3", "Annotator 4", "Annotator 5", "Annotator 6", "Annotator 7", "Annotator 8", "Annotator 9", "Annotator 10")

rownames(df) <- rownames
colnames(df) <- colnames

write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK_initial/doc_overlap.csv")
```
Tag counts
```{r}
# Already there from the "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/src/inter_annotators_matrix.ipynb"
```

DANSK
- Overall
```{r}
# Overall has be made manually; located in "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/overall.tgn")
```
- Overall, including Source
```{r}
# Get information
domains = colnames(read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/full/domain_desc_stats_wide.csv"))[-1]
sources = colnames(read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/full/source_desc_stats_wide.csv"))[-1]
n_docs_in_source_full <- t(read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/full/source_desc_stats_wide.csv")[1,])[-1]
n_docs_in_source_train <- t(read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/train/source_desc_stats_wide.csv")[1,])[-1]
n_docs_in_source_dev <- t(read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/dev/source_desc_stats_wide.csv")[1,])[-1]
n_docs_in_source_test <- t(read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/test/source_desc_stats_wide.csv")[1,])[-1]

# Create nested list
nested_list = list(Source=sources,
                      Full=n_docs_in_source_full,
                      Train=n_docs_in_source_train,
                      Dev=n_docs_in_source_dev,
                      Test=n_docs_in_source_test)


# Convert nested list to the dataframe by columns
df <- as.data.frame(do.call(cbind, nested_list))
df <- df %>%
  mutate(Domain = case_when(
    endsWith(Source, 'retsinformationdk') ~'Legal',
    endsWith(Source, 'skat') ~'Legal',
    endsWith(Source, 'retspraksis') ~'Legal',
    endsWith(Source, 'hest') ~'Social Media',
    endsWith(Source, 'cc') ~'Web',
    endsWith(Source, 'adl') ~'Wiki & Books',
    endsWith(Source, 'botxt') ~'Other',
    endsWith(Source, 'danavis') ~'News',
    endsWith(Source, 'dannet') ~'Dannet',
    endsWith(Source, 'depbank') ~'Other',
    endsWith(Source, 'ep') ~'Conversation',
    endsWith(Source, 'ft') ~'Conversation',
    endsWith(Source, 'gutenberg') ~'Wiki & Books',
    endsWith(Source, 'jvj') ~'Wiki & Books',
    endsWith(Source, 'naat') ~'Conversation',
    endsWith(Source, 'opensub') ~'Conversation',
    endsWith(Source, 'relig') ~'Wiki & Books',
    endsWith(Source, 'spont') ~'Conversation',
    endsWith(Source, 'synne') ~'Other',
    endsWith(Source, 'tv2r') ~'News',
    endsWith(Source, 'wiki') ~'Wiki & Books',
    endsWith(Source, 'wikibooks') ~'Wiki & Books',
    endsWith(Source, 'wikisource') ~'Wiki & Books',
    endsWith(Source, 'twfv19') ~'Social Media',
    ))

# Have domain as first column
df <- df %>%
  select(Domain, everything())

# Order by domain
df <- df[order(df$Domain),]

# Save as csv
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/general_sources.csv")
```
- Full distributions (tag distribution within domain and source)
```{r}
# Full
full = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/full/domain_desc_stats_wide.csv")
full = full[,order(colnames(full))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(full) = new_col_names
full <- full[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
full[full == "N/A"] <- NA
full[is.na(full)] <- 0
write.csv(full, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/full_domain.csv")

full = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/full/source_desc_stats_wide.csv")
full = full[,order(colnames(full))]
full[full == "N/A"] <- NA
full[is.na(full)] <- 0
columnn = full["X"]
full = full %>% select(!"X") %>%  mutate_if(is.character, as.numeric)
full = cbind(columnn,full)
full2 <- full[,-1]
rownames(full2) <- full[,1]
full = full2
full["Across all sources"] = rowSums(full)
full <- full %>%
  select("Across all sources", everything())
# new_row = c('Full source name','Archive for Danish Literature', 'Common Crawl', 'Danish daily newspapers', 'DanNet (Danish WordNet)', 'European Parliament', 'Folketinget (Danish Parliament)', 'Hestenettet (Danish debate forum)', 'NAAT', 'Open Subtitles', 'retsinformation.dk (Danish legal information)', 'retspraksis (Danish legal information)', 'Skat (Danish tax authority)', 'Spontaneous speech', 'TV 2 Radio (Danish news)', 'Wikipedia', 'Wikibooks', 'Wikisource')
# full = rbind(new_row, full)
write.csv(full, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/full_source.csv")

```
- Train distributions (tag distribution within domain and source)
```{r}

# Train
train = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/train/domain_desc_stats_wide.csv")
train = train[,order(colnames(train))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(train) = new_col_names
train <- train[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
train[train == "N/A"] <- NA
train[is.na(train)] <- 0
write.csv(train, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/train_domain.csv")

train = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/train/source_desc_stats_wide.csv")
train = train[,order(colnames(train))]
train[train == "N/A"] <- NA
train[is.na(train)] <- 0
columnn = train["X"]
train = train %>% select(!"X") %>%  mutate_if(is.character, as.numeric)
train = cbind(columnn,train)
train2 <- train[,-1]
rownames(train2) <- train[,1]
train = train2
train["Across all sources"] = rowSums(train)
train <- train %>%
  select("Across all sources", everything())
# new_row = c('train source name','Archive for Danish Literature', 'Common Crawl', 'Danish daily newspapers', 'DanNet (Danish WordNet)', 'European Parliament', 'Folketinget (Danish Parliament)', 'Hestenettet (Danish debate forum)', 'NAAT', 'Open Subtitles', 'retsinformation.dk (Danish legal information)', 'retspraksis (Danish legal information)', 'Skat (Danish tax authority)', 'Spontaneous speech', 'TV 2 Radio (Danish news)', 'Wikipedia', 'Wikibooks', 'Wikisource')
# train = rbind(new_row, train)
write.csv(train, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/train_source.csv")

```
- Dev distributions (tag distribution within domain and source)
```{r}

# Dev
dev = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/dev/domain_desc_stats_wide.csv")
dev = dev[,order(colnames(dev))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(dev) = new_col_names
dev <- dev[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
dev[dev == "N/A"] <- NA
dev[is.na(dev)] <- 0
write.csv(dev, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/dev_domain.csv")

dev = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/dev/source_desc_stats_wide.csv")
dev = dev[,order(colnames(dev))]
dev[dev == "N/A"] <- NA
dev[is.na(dev)] <- 0
columnn = dev["X"]
dev = dev %>% select(!"X") %>%  mutate_if(is.character, as.numeric)
dev = cbind(columnn,dev)
dev2 <- dev[,-1]
rownames(dev2) <- dev[,1]
dev = dev2
dev["Across all sources"] = rowSums(dev)
dev <- dev %>%
  select("Across all sources", everything())
# new_row = c('dev source name','Archive for Danish Literature', 'Common Crawl', 'Danish daily newspapers', 'DanNet (Danish WordNet)', 'European Parliament', 'Folketinget (Danish Parliament)', 'Hestenettet (Danish debate forum)', 'NAAT', 'Open Subtitles', 'retsinformation.dk (Danish legal information)', 'retspraksis (Danish legal information)', 'Skat (Danish tax authority)', 'Spontaneous speech', 'TV 2 Radio (Danish news)', 'Wikipedia', 'Wikibooks', 'Wikisource')
# dev = rbind(new_row, dev)
write.csv(dev, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/dev_source.csv")

```
- Test distributions (tag distribution within domain and source)
```{r}

# Test
test = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/test/domain_desc_stats_wide.csv")
test = test[,order(colnames(test))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books", "X")
colnames(test) = new_col_names
test <- test[, c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
test[test == "N/A"] <- NA
test[is.na(test)] <- 0
write.csv(test, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/test_domain.csv")

test = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_descriptive/test/source_desc_stats_wide.csv")
test = test[,order(colnames(test))]
test[test == "N/A"] <- NA
test[is.na(test)] <- 0
columnn = test["X"]
test = test %>% select(!"X") %>%  mutate_if(is.character, as.numeric)
test = cbind(columnn,test)
test2 <- test[,-1]
rownames(test2) <- test[,1]
test = test2
test["Across all sources"] = rowSums(test)
test <- test %>%
  select("Across all sources", everything())
# new_row = c('test source name','Archive for Danish Literature', 'Common Crawl', 'Danish daily newspapers', 'DanNet (Danish WordNet)', 'European Parliament', 'Folketinget (Danish Parliament)', 'Hestenettet (Danish debate forum)', 'NAAT', 'Open Subtitles', 'retsinformation.dk (Danish legal information)', 'retspraksis (Danish legal information)', 'Skat (Danish tax authority)', 'Spontaneous speech', 'TV 2 Radio (Danish news)', 'Wikipedia', 'Wikibooks', 'Wikisource')
# test = rbind(new_row, test)
write.csv(test, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/DANSK/test_source.csv")
```

SOTA
- Recall, Precision, F1-score
- Domain
- Tag
```{r}
# Recall, precision and F1-score
# Already present in "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/f1_recall_precision.csv")

# Domain (including across domains)
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books")
colnames(df) = new_col_names
df <- df[c(1, 2, 3, 10, 4, 5, 6, 7, 8, 9),]
df = round(df, 3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/domain.csv")

# Tag
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/tag_f1_wide.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
df = round(df, 3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/SOTA/tag.csv")

```

NER
- Type performance
- Recall, Precision, F1-score
- Domain
- Tag
```{r} 
# Type performance
df = read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/types_matches_f1.csv")
df["Model"] = c("da_dacy_small_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_large_ner_fine_grained")
df = df %>% select(!"X")
colnames(df) = c("Model", "F1 Strict Match", "F1 Exact Match", "F1 Partial Match", "Entity Type Match")
df = df %>% mutate_if(is.numeric, round, digits=3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/type.csv")

# Recall, Precision and F1-score
# Already present in "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/f1_recall_precision.csv")

# Domain
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/domain_f1_wide.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
new_col_names = c("All domains combined", "Conversation", "Dannet", "Legal", "News", "Social Media", "Web", "Wiki and Books")
colnames(df) = new_col_names
df = round(df, 3)
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/domain.csv")

# Tag
# Load dataset
df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/ner_models_performance/tag_f1_wide.csv", header=T)
df <- df %>% column_to_rownames(., var = 'Model')
df = df[,order(colnames(df))]
df = df  %>% select(!Domain)
df = round(df, 3)
colnames(df)[18] = "WORK OF ART"
write.csv(df, "/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/Thesis/NER/tag.csv")

```


# OLD, MIGHT NOT USE:
output/DANSK_initial_interrater/kappa_also_non_annotated.csv 
```{r}
# # Load dataset
# df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_also_non_annotated.csv", header=T)
# 
# # Clean up dataset
# df <- df %>% select(!(name=c("X","rater_avg"))) # Remove first and last columns
# colnames(df) <- c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")#, "rater_avg") # Change colnames
# 
# # Make into long format
# df_wide <- df %>%
#   rownames_to_column() %>%
#   gather(colname, value, -rowname)
# 
# # Have annotators as factors
# df_wide$rowname <- as.factor(df_wide$rowname) 
# df_wide$colname <- as.factor(df_wide$colname) 
# 
# # Remove rows with kappa score between same annotators
# df_wide = df_wide %>% filter(colname != rowname)
# 
# # Create plot
# ggplot(df_wide, aes(x = reorder(rowname, sort(as.numeric(rowname), decreasing=T)), y = value, fill=reorder(rowname, sort(as.numeric(rowname),decreasing=T)))) +
#   # Violin plot, don't trim 
#   geom_violin(trim=FALSE) +
#   
#   # Include boxplot also
#   geom_boxplot(width=.1,
#                fill="white") + 
#   
#   # Set theme
#   theme(plot.title = element_text(hjust = 0.5), 
#         plot.# subtitle = element_text(hjust = 0.5),
#         legend.position="right") +
#   
#   # Set labs
#   labs(# title = "Cohen's Kappa all tokens",
#        # subtitle = "Cohens Kappa scores between annotators, when including all tokens",
#        x = "Annotator", 
#        y = "Cohen's Kappa",
#        fill='Annotator')
# 
# # Save plot
# ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_also_non_annotated_plot.png")
```
output/DANSK_initial_interrater/kappa_annotated.csv
```{r}
# # Load dataset
# df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_annotated.csv", header=T)
# 
# # Clean up dataset
# df <- df %>% select(!(name=c("X","rater_avg"))) # Remove first and last columns
# colnames(df) <- c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")#, "rater_avg") # Change colnames
# 
# # Make into long format
# df_wide <- df %>%
#   rownames_to_column() %>%
#   gather(colname, value, -rowname)
# 
# # Have annotators as factors
# df_wide$rowname <- as.factor(df_wide$rowname) 
# df_wide$colname <- as.factor(df_wide$colname) 
# 
# # Remove rows with kappa score between same annotators
# df_wide = df_wide %>% filter(colname != rowname)
# 
# # Create plot
# ggplot(df_wide, aes(x = reorder(rowname, sort(as.numeric(rowname), decreasing=T)), y = value, fill=reorder(rowname, sort(as.numeric(rowname),decreasing=T)))) +  
#   
#   # Violin plot, don't trim 
#   geom_violin(trim=FALSE) +
#   
#   # Include boxplot also
#   geom_boxplot(width=.1,
#                fill="white") + 
#   
#   # Set theme
#   theme(plot.title = element_text(hjust = 0.5), 
#         plot.# subtitle = element_text(hjust = 0.5),
#         legend.position="right") +
#   
#   # Set labs
#   labs(# title = "Cohen's Kappa all tokens",
#        # subtitle = "Cohens Kappa scores between annotators, only including annotated tokens",
#        x = "Annotator", 
#        y = "Cohen's Kappa",
#        fill='Annotator')
# 
# # Save plot
# ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/kappa_annotated_plot.png")
```
output/DANSK_initial_interrater/tag_counts.csv SKIP BELOW ON TAG_COUNTS; DATA SHOWS NUMBER OF TOKENS WITH TAGS, INSTEAD OF NUMBER OF TAGS IN DOCUMENTS
```{r}
# # Load dataset
# df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/DANSK_initial_interrater/tag_counts.csv", header=T)
# 
# # Clean up dataset
# colnames(df) <- c("Tag ","1", "2", "3", "4", "5", "6", "7", "8", "9", "10")#, "rater_avg") # Change colnames
# 
# # Set Tag column as row names
# rownames(df) <- df$Tag
# 
# # Remove Tag column from columns
# df <- df %>% select(c(2:length(colnames(df))))
# 
# # Make into long format
# df_wide <- df %>%
#   rownames_to_column() %>%
#   gather(colname, value, -rowname)
# 
# # Have annotators as factors
# df_wide$rowname <- as.factor(df_wide$rowname)
# df_wide$colname <- as.factor(df_wide$colname)
# 
# # Create plot
# ggplot(df_wide, aes(x = rowname, y = value, fill=rowname)) + 
#   
#   # Make boxplot
#   geom_boxplot() + 
#   
#   # Set theme
#   theme(plot.title = element_text(hjust = 0.5), 
#         plot.# subtitle = element_text(hjust = 0.5),
#         legend.position="right") +
#   
#   # Set labs
#   labs(# title = "Cohen's Kappa all tokens",
#        # subtitle = "Cohens Kappa scores between annotators, only including annotated tokens",
#        x = "Annotator", 
#        y = "Cohen's Kappa",
#        fill='Annotator')

```
something
```{r}
# # Load data
# df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)
# 
# # Set model values as rownames
# df <- df %>% column_to_rownames(., var = 'Model')
# 
# # Remove the across domains
# df <- df %>% select(!(name="across_domains"))
# 
# df
# 
# # Make into long format
# df_wide <- df %>%
#   rownames_to_column() %>%
#   gather(colname, value, -rowname)
# 
# # As factors
# df_wide$rowname <- as.factor(df_wide$rowname) 
# df_wide$colname <- as.factor(df_wide$colname) 
# 
# # Order by custom ordering:
# df_wide$rowname <- factor(df_wide$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm"))
# 
# # # Plot 
# # ggplot(df_wide, aes(y=value, x=rowname, fill=rowname)) + 
# #   # Geom_bar
# #   geom_bar(position = position_dodge(width = 0.7),
# #            width=0.7,
# #            stat="identity",
# #            #fill="white",
# #            colour="black") +
# #   
# #   scale_fill_brewer(palette = "Set2") +  
# #   
# #     # Add text with F1-scores
# #   geom_text(aes(label=round(value, 2)), vjust=1.6, color="white", size=5, position = position_dodge(0.7)) +
# #   
# #   # Set theme
# #   theme(plot.title = element_text(hjust = 0.5), 
# #         plot.# subtitle = element_text(hjust = 0.5),
# #         legend.position="right") +
# #   
# #   # Set labs
# #   labs(title = "F1-scores across domains",
# #        # subtitle = "F1-performance of Danish SOTA models",
# #        x = "Model", 
# #        y = "F1-score",
# #        fill = 'Model') +
# #   
# #   theme(axis.text.x=element_blank()) +  
# #   #theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
# #   
# #   # Facet_wrap
# #   facet_wrap(~colname, ncol=3)
# 
# # Plot 
# ggplot(df_wide, aes(y=value, x=colname, color=colname)) + 
#   # Geom_bar
#   geom_point(#position = position_dodge(width = 1),
#            #width=1,
#            stat="identity") + #,
#            #fill="white",
#            #colour="black") +
#   
#   coord_flip() + 
#   
#   scale_color_brewer(palette = "Set2") +  
#   
#   # Add text with F1-scores
#   #geom_text(aes(label=round(value, 2)), hjust=1.6, color="black", size=4, position = position_dodge(1)) +
#   
#   # Set theme
#   # theme(plot.title = element_text(hjust = 0.5), 
#   #       plot.# subtitle = element_text(hjust = 0.5),
#   #       legend.position="right") +
#   # 
#   # Set labs
#   labs(# title = "F1-scores across domains",
#        # subtitle = "F1-performance of Danish SOTA models",
#        x = "",#"Domain", 
#        y = "F1-score",
#        fill= 'Domain') +
#   
#   theme(axis.text.x=element_blank())# +
#   #theme(axis.text.x=element_text(angle = -90, hjust = 0, vjust = 0)) +
#   
#   # Facet_wrap
#   #facet_wrap(~rowname, ncol=2)
# 
# # Save plot
# ggsave("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long_plot.png")
```
output/other_models_performance/domain_f1_long.csv
```{r}
# # Load data
# df <- read.csv("/Users/emiltrencknerjessen/Desktop/priv/DANSK_eval/output/other_models_performance/domain_f1_long.csv", header=T)
# 
# # Keep only the across domains
# df <- df %>% select(c("rowname"="Model", "value"="across_domains"))
# 
# # Factor by right order
# df$rowname <- fct_rev(factor(df$rowname, levels=c("da_dacy_large_ner_fine_grained", "da_dacy_medium_ner_fine_grained", "da_dacy_small_ner_fine_grained", "saattrupdan/nbailab-base-ner-scandi", "da_dacy_large_trf", "da_dacy_medium_trf", "da_dacy_small_trf", "da_core_news_lg", "da_core_news_md","da_core_news_sm")))
# 
# palette_blues <- colorRampPalette(colors = c("white", "#004b88"))(20)
# palette_blues
# 
# # Plot
# ggplot(df, aes(fill=rowname, y=value, x=rowname)) + 
#   # Geom_bar
#   geom_bar(position = position_dodge(width = .8),
#            width=.7,
#            stat="identity",
#            colour="black") +
#   
#   # Add text with F1-scores
#   geom_text(aes(label=round(value, 2)), hjust=1.6, color="black", size=4.5, position = position_dodge(0.8)) +
#   
#   scale_fill_brewer(palette = "palette_blues") +  
# 
#   # Set theme
#   theme(plot.title = element_text(hjust = 0.5), 
#         plot.# subtitle = element_text(hjust = 0.5),
#         legend.position="none") +
#   
#   coord_flip() +
#   
#   # Let x-axis dodge to avoid clutter
#   #scale_x_discrete(guide = guide_axis(n.dodge=2)) +
#   
#   # Set labs
#   labs(# title = "F1-scores",
#        # subtitle = "F1-performance of Danish SOTA models",
#        x = "Model", 
#        y = "F1-score")

```



